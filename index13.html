<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¯ãƒ¼ãƒ«ãªã‚«ãƒ¼ãƒŠãƒ“ã‚¢ãƒ—ãƒª</title>    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dexie/3.2.3/dexie.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Arial', sans-serif;
        }
        #container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #map {
            flex: 3;
            width: 100%;
        }
        /* ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‹ã„ãŸã¨ãã®mapã®ä½ç½® */
        #map.shifted {
            margin-left: 250px;  /* ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å¹… + ä½™ç™½ */
            transition: .4s;
        }
        #developer-group {
            flex: 3;
            width: 100%;
        }
        #developer-group.shifted {
            margin-left: 250px;  /* ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å¹… + ä½™ç™½ */
            transition: .4s;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 200px; /* ç¸¦å¹…ã‚’50pxã«è¨­å®š */
            margin-bottom: 10px; /* å„ã‚°ãƒ©ãƒ•ã®é–“ã«å°‘ã—ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ  */
        }
        .cool-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 24px;
            z-index: 1000;
        }
        #course-selector {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
        }

        #recenter-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }

        #recenter-button button {
            background-color: #007BFF; /* èƒŒæ™¯è‰²ã‚’ãƒ–ãƒ«ãƒ¼ã« */
            color: white; /* æ–‡å­—è‰²ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ï¼‰ã‚’ç™½ã« */
            border: none; /* æ ç·šã‚’ãªã— */
            padding: 15px;
            border-radius: 50%; /* ä¸¸ã„å½¢ã«ã™ã‚‹ */
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* ãƒœã‚¿ãƒ³ã®ã‚·ãƒ£ãƒ‰ã‚¦ */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* ãƒ›ãƒãƒ¼æ™‚ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³åŠ¹æœ */
        }

        #recenter-button button:hover {
            transform: scale(1.1); /* ãƒ›ãƒãƒ¼æ™‚ã«å°‘ã—å¤§ããã™ã‚‹ */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); /* ãƒ›ãƒãƒ¼æ™‚ã®ã‚·ãƒ£ãƒ‰ã‚¦ã‚’å¼·èª¿ */
        }

        #recenter-button i {
            font-size: 20px; /* ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚º */
        }
        #sidemenu-toggle {
            /*position: absolute;*/
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        #sidemenu {
            position: fixed;
            left: -250px;      /*è¦‹ãˆãªã„ã‚ˆã†ã«éš ã—ã¦ã‚‹ã¨ã“*/
            top: 0;
            width: 250px;
            height: 100%;
            background-color: #333;
            color: #fff;
            transition: 0.3s;
            z-index: 1000;
            padding: 20px;
            box-sizing: border-box;
        }
        #sidemenu.open {
            left: 0;
        }
        #sidemenu:hover {
            left: 0;
        }
        #sidemenu table {
            width: 100%;
            margin-top: 50px;
        }
        #sidemenu td {
            padding: 10px 0;
            border-bottom: 1px solid #555;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2196F3;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        #control-buttons {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        #control-buttons button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #2196F3;
            color: white;
        }
        #control-buttons button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #file-upload {
            display: none;
        }
        #upload-label {
            display: inline-block;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
            border-radius: 5px;
        }
        @keyframes blink {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        .recording-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: red;
            border-radius: 50%;
            margin-left: 10px;
            animation: blink 1s infinite;
        }
        #button-container {
            /*position: absolute;*/
            /*bottom: 0px;*/
            left: 10%;
            transform: translateX(20%);
            display: flex;
            gap: 15px; /* ãƒœã‚¿ãƒ³é–“ã®é–“éš” */
            margin: 10px 0;
            flex-wrap: wrap; /* å°ã•ã„ç”»é¢ã§ã¯ãƒœã‚¿ãƒ³ãŒæŠ˜ã‚Šè¿”ã™ */
        }
        #button-container button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #06b300;
            color: white;
        }

    </style>
</head>
<body>
    <div id="container">
        <div id="map"></div>
    </div>
    <div class="cool-title">ã‚¯ãƒ¼ãƒ«ã‚«ãƒ¼ãƒŠãƒ“ ver0.13<span id="recording-indicator" class="recording-indicator" style="display: none;"></span></div>
    <div id="course-selector">
        <select id="course-dropdown">
            <option value="non_cource"> - </option>
            <option value="nagoya_tour">åå¤å±‹é§…å‘¨è¾ºãƒ„ã‚¢ãƒ¼</option>
            <option value="nagoya_to_okazaki">åå¤å±‹é§…ã‹ã‚‰å²¡å´é§…ã¾ã§</option>
        </select>
    </div>
    <div id="sidemenu-toggle">â˜°</div>
    <div id="sidemenu">
        <table>
            <tr><td>ãƒ›ãƒ¼ãƒ </td></tr>
            <tr><td>è¨­å®š</td></tr>
            <tr>
                <td>
                    ã‚¹ãƒãƒƒãƒˆè¡¨ç¤º
                    <label class="switch">
                        <input type="checkbox" id="favoriteModeToggle">
                        <span class="slider"></span>
                    </label>
                </td>
            </tr>
            <tr><td>ãƒ˜ãƒ«ãƒ—</td></tr>
            <tr>
                <td>
                    é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰
                    <label class="switch">
                        <input type="checkbox" id="devModeToggle">
                        <span class="slider"></span>
                    </label>
                </td>
            </tr>
        </table>
        <br><br><hr>
        <input type="checkbox" id="pin-checkbox">
        <label for="pin-checkbox">ğŸ“Œ ãƒ”ãƒ³ç•™ã‚</label>
    </div>

    <div id="recenter-button">
        <!--<button>ç¾åœ¨åœ°ã«æˆ»ã‚‹</button>-->
        <button><i class="fas fa-location-arrow"></i></button>
    </div>

    <!-- ã‚°ãƒ©ãƒ• -->
    <div class="developer-group" id="developer-group">
        <div id="button-container" class="developer-group">
        <!--<div id="controls developer-group"></div>-->
            <button id="startplotButton">Start</button>
            <button id="stopplotButton" disabled>Stop</button>
            <button id="resetplotButton">Reset</button>
        </div>

        <div class="chart-container developer-group">
            <canvas id="latitudeChart"></canvas>
        </div> 
        <div class="chart-container developer-group">
            <canvas id="longitudeChart"></canvas>
        </div>
        <div class="chart-container developer-group">
            <canvas id="speedChart"></canvas>
        </div>
    </div>

    <div id="control-buttons">
        <button id="start-recording">è¨ˆæ¸¬é–‹å§‹</button>
        <button id="stop-recording" disabled>åœæ­¢</button>
        <button id="download-route" style="display: none;">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
        <label for="file-upload" id="upload-label">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</label>
        <input type="file" id="file-upload" accept=".json, .gpx">
    </div>
    
    <script>

        // ãƒ•ãƒ©ã‚°åˆæœŸè¨­å®š
        let flg_developer_mode = false  // é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã®ãƒ•ãƒ©ã‚°ï¼šOFF=false, ON=true
        let flg_chart_plotting = false  // ã‚°ãƒ©ãƒ•æç”»ã®æ›´æ–°ãƒ•ãƒ©ã‚°ï¼šOFF=false, ON=true

        // åå¤å±‹é§…ã®åº§æ¨™
        const nagoyaStation = [35.170915, 136.881537];
        
        // åœ°å›³ã®åˆæœŸåŒ–
        const map = L.map('map').setView(nagoyaStation, 13);

        // OpenStreetMapã®ã‚¿ã‚¤ãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // åœ°å›³ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å·¦ä¸‹ã«é…ç½®
        map.zoomControl.setPosition('bottomleft');

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®ã‚’è¡¨ã™ãƒãƒ¼ã‚«ãƒ¼
        let userMarker;

        // ãƒŠãƒ“ã‚³ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼
        //let courseLayer;
        // å¤‰æ•°å®šç¾©ï¼šã‚³ãƒ¼ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä¿æŒã™ã‚‹å¤‰æ•°ã‚’åˆæœŸåŒ–
        let courseLayer = null;

        // class=developer-groupã®è¦ç´ ã™ã¹ã¦ã‚’ä¸€æ‹¬ã§è¡¨ç¤º/éè¡¨ç¤ºåˆ‡æ›¿ãˆã‚‹é–¢æ•°
        function developer_group_visibility(show) {
            document.querySelectorAll('.developer-group').forEach(element => {
                element.style.display = show ? 'block' : 'none';
            });
        }
        developer_group_visibility(false);

        let watchId;
        let prevLat = null;
        let prevLon = null;
        let prevTime = null;
        let isUpdating = false;

        // ç·¯åº¦ã‚°ãƒ©ãƒ•ã®åˆæœŸåŒ–
        const latitudeCtx = document.getElementById('latitudeChart').getContext('2d');
        const latitudeChart = new Chart(latitudeCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Latitude',
                    data: [],
                    borderColor: 'rgb(255, 99, 132)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            autoSkip: true,
                        }
                    }
                }
            }
        });

        // çµŒåº¦ã‚°ãƒ©ãƒ•ã®åˆæœŸåŒ–
        const longitudeCtx = document.getElementById('longitudeChart').getContext('2d');
        const longitudeChart = new Chart(longitudeCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Longitude',
                    data: [],
                    borderColor: 'rgb(54, 162, 235)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            autoSkip: true,
                        }
                    }
                }
            }
        });

        // ç§»å‹•é€Ÿåº¦ã‚°ãƒ©ãƒ•ã®åˆæœŸåŒ–
        const speedCtx = document.getElementById('speedChart').getContext('2d');
        const speedChart = new Chart(speedCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Speed (m/s)',
                    data: [],
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            autoSkip: true,
                        }
                    }
                }
            }
        });

        // IndexedDBã®åˆæœŸåŒ–
        const db = new Dexie('RouteDatabase');
        db.version(1).stores({
            rowdata: '++id, timestamp, latitude, longitude'
        });

        // ãƒŠãƒ“ã‚³ãƒ¼ã‚¹ã®GeoJSONãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
        async function loadCourse(courseName) {
            if (courseName === 'uploaded_course') {
                console.log("é¸æŠä¸­ã®ã‚³ãƒ¼ã‚¹ã¯ï¼š"+courseName)
                return JSON.parse(localStorage.getItem('uploadedCourse'));
            } else if (courseName === 'non_cource') {
                console.log("é¸æŠä¸­ã®ã‚³ãƒ¼ã‚¹ã¯ï¼šä½•ã‚‚æŒ‡å®šã—ã¦ãªã„ã§ã™: "+courseName)
                return JSON.parse(jsonData_non_cource);
            } else if (courseName === 'nagoya_to_okazaki') {
                console.log("é¸æŠä¸­ã®ã‚³ãƒ¼ã‚¹ã¯: "+courseName)
                return JSON.parse(jsonData_nagoya_to_okazaki);
            } else if (courseName === 'nagoya_tour') {
                console.log("é¸æŠä¸­ã®ã‚³ãƒ¼ã‚¹ã¯ï¼š"+courseName)
                // ãƒ«ãƒ¼ãƒˆã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å–å¾—ã™ã‚‹å ´åˆã®ã‚³ãƒ¼ãƒ‰ãƒ¡ãƒ¢
                //const response = await fetch('static/root1.json');
                //const data = await response.json();
                return JSON.parse(jsonData_nagoya_tour);
                return data;
            }
        }

        // ã‚³ãƒ¼ã‚¹ã‚’åœ°å›³ä¸Šã«è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function displayCourse(geoJson) {
            // ã™ã§ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ã‚¹ãŒã‚ã‚Œã°å‰Šé™¤ã™ã‚‹ï¼ˆã“ã‚Œã«ã‚ˆã‚Šåˆ¥ã®ã‚³ãƒ¼ã‚¹ãŒé¸æŠã•ã‚ŒãŸã¨ãã«å‰ã®çµŒè·¯ã‚’æ¶ˆã™ï¼‰
            if (courseLayer) {
                map.removeLayer(courseLayer);
            }

            // æ–°ã—ã„ã‚³ãƒ¼ã‚¹ã®çµŒè·¯ã‚’åœ°å›³ã«è¿½åŠ ã™ã‚‹
            courseLayer = L.geoJSON(geoJson, {
                style: {
                    color: '#3388ff',  // çµŒè·¯ã®è‰²
                    weight: 8,  // çµŒè·¯ã®ç·šã®å¤ªã•
                    opacity: 0.8  // çµŒè·¯ã®é€æ˜åº¦
                }
            }).addTo(map);

            // çµŒè·¯å…¨ä½“ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«åœ°å›³ã®è¡¨ç¤ºç¯„å›²ã‚’èª¿æ•´
            if (courseLayer) {
                userInteracting = true;
                map.fitBounds(courseLayer.getBounds());
            }
        }
        
        // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†
        document.getElementById('course-dropdown').addEventListener('change', async (event) => {
            const selectedCourse = event.target.value;
            
            // ã‚³ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const courseData = await loadCourse(selectedCourse);
            
            // ã‚³ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããŸå ´åˆã®ã¿ã€åœ°å›³ã«è¡¨ç¤º
            if (courseData) {
                displayCourse(courseData);
                //// ã‚¹ãƒãƒƒãƒˆã‚’è¡¨ç¤º
                //const spotData = document.getElementById('spots').textContent;
                //displaySpots(spotData);
            }
        });

        // åˆæœŸã‚³ãƒ¼ã‚¹ã‚’èª­ã¿è¾¼ã‚€
        loadCourse('non_cource').then(displayCourse);

        // ã‚¹ãƒãƒƒãƒˆç”¨ã®ãƒãƒ¼ã‚«ãƒ¼é…åˆ—ã‚’åˆæœŸåŒ–
        let spotMarkers = [];
        // ã‚¹ãƒãƒƒãƒˆã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function displaySpots(spotData) {
            // ã‚¹ãƒãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹
            const spots = JSON.parse(spotData).spots;

            // SVGã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œæˆã—ã¦åŸ‹ã‚è¾¼ã‚€
            const greenMarkerIcon = L.divIcon({
                className: 'green-marker-icon',
                html: `
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="40" viewBox="0 0 30 40">
                        <path d="M15 0C7.2 0 0 7.2 0 15c0 8.1 15 25 15 25s15-16.9 15-25c0-7.8-7.2-15-15-15zm0 22c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7z" fill="green"/>
                    </svg>
                `,
                iconSize: [30, 40],
                iconAnchor: [15, 40], // ã‚¢ã‚¤ã‚³ãƒ³ã®ä¸‹éƒ¨ã‚’åŸºæº–ç‚¹ã«
            });

            // å„ã‚¹ãƒãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆã—ã€åœ°å›³ä¸Šã«è¿½åŠ 
            spots.forEach(spot => {
                const marker = L.marker(spot.coordinates.reverse(), { icon: greenMarkerIcon }).addTo(map);

                marker.bindPopup(`
                    <strong>${spot.name}</strong><br>
                    <img src="${spot.image}" alt="${spot.name}" style="width:100px;height:auto;"><br>
                    ${spot.description}
                `);

                // ä½œæˆã—ãŸãƒãƒ¼ã‚«ãƒ¼ã‚’é…åˆ—ã«ä¿å­˜
                spotMarkers.push(marker);
            });
        }

        // ã‚¹ãƒãƒƒãƒˆã‚’éè¡¨ç¤ºã«ã™ã‚‹é–¢æ•°
        function hideSpots() {
            // é…åˆ—ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’åœ°å›³ã‹ã‚‰å‰Šé™¤
            spotMarkers.forEach(marker => {
                map.removeLayer(marker);
            });

            // ãƒãƒ¼ã‚«ãƒ¼é…åˆ—ã‚’ã‚¯ãƒªã‚¢
            spotMarkers = [];
        }

        // ã‚¹ãƒãƒƒãƒˆã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
        let spotsVisible = false;
        function toggleSpots(spotData) {
            if (spotsVisible) {
                hideSpots();  // ç¾åœ¨è¡¨ç¤ºä¸­ãªã‚‰éè¡¨ç¤ºã«ã™ã‚‹
            } else {
                displaySpots(spotData);  // ç¾åœ¨éè¡¨ç¤ºãªã‚‰è¡¨ç¤ºã™ã‚‹
            }
            spotsVisible = !spotsVisible;  // è¡¨ç¤ºçŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
        }
    

        //// ã‚¹ãƒãƒƒãƒˆã‚’åœ°å›³ä¸Šã«è¡¨ç¤ºã™ã‚‹é–¢æ•°
        //function displaySpots(spotData) {
        //    const spots = JSON.parse(spotData).spots;

        //    // SVGã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œæˆã—ã¦åŸ‹ã‚è¾¼ã‚€
        //    const greenMarkerIcon = L.divIcon({
        //        className: 'green-marker-icon',
        //        html: `
        //            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="40" viewBox="0 0 30 40">
        //                <path d="M15 0C7.2 0 0 7.2 0 15c0 8.1 15 25 15 25s15-16.9 15-25c0-7.8-7.2-15-15-15zm0 22c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7z" fill="green"/>
        //            </svg>
        //        `,
        //        iconSize: [30, 40],
        //        iconAnchor: [15, 40], // ã‚¢ã‚¤ã‚³ãƒ³ã®ä¸‹éƒ¨ã‚’åŸºæº–ç‚¹ã«
        //    });

        //    spots.forEach(spot => {
        //        //const marker = L.marker(spot.coordinates.reverse()).addTo(map);
        //        const marker = L.marker(spot.coordinates.reverse(), { icon: greenMarkerIcon }).addTo(map);

        //        marker.bindPopup(`
        //            <strong>${spot.name}</strong><br>
        //            <img src="${spot.image}" alt="${spot.name}" style="width:100px;height:auto;"><br>
        //            ${spot.description}
        //        `);
        //    });
        //}



        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåœ°å›³ã‚’æ“ä½œã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°ï¼ˆç¾åœ¨åœ°ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã‚‹ã¾ã§falseã«æˆ»ã‚‰ãªã„ï¼‰
        let userInteracting = false;

        // ãƒãƒ¼ã‚«ãƒ¼ãƒ”ãƒ³ã«SVGã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œæˆã—ã¦åŸ‹ã‚è¾¼ã‚€
        const simpleArrowIcon = L.divIcon({
            className: 'simple-arrow-icon',
            html: `
                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100">
                    <polygon points="50,10 10,90 50,70 90,90" fill="#2A66F0" stroke="#000" stroke-width="1"/>
                </svg>
            `,
            iconSize: [50, 50],
            iconAnchor: [25, 50],
            popupAnchor: [0, -50],
        });

        // ä½ç½®æƒ…å ±ã®æ›´æ–°é–¢æ•°
        async function updatePosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            //console.log("func:updatePosition run. " + lat + ", " + lon);
            
            // ãƒãƒ¼ã‚«ãƒ”ãƒ³ã®ä½ç½®ã‚’æ›´æ–°
            if (userMarker) {
                userMarker.setLatLng([lat, lon]);
            } else {
                //userMarker = L.marker([lat, lon]).addTo(map);
                userMarker = L.marker([lat, lon], { icon: simpleArrowIcon }).addTo(map);
            }

            // ãƒ¦ãƒ¼ã‚¶ãŒåœ°å›³æ“ä½œä¸­ã®å ´åˆã¯ã€ãƒãƒ¼ã‚«ãƒ”ãƒ³ã‚’ç”»é¢ä¸­å¿ƒã«è£œæ­£ã™ã‚‹å‡¦ç†ã‚’ã—ãªã„
            if (!userInteracting) {
                map.setView([lat, lon]);
            }

            if (flg_chart_plotting) {
                console.log("ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°")
                const now = new Date();
                const timeNow = now.getTime();

                latitudeChart.data.labels.push(now.toLocaleTimeString());
                latitudeChart.data.datasets[0].data.push(lat);
                
                longitudeChart.data.labels.push(now.toLocaleTimeString());
                longitudeChart.data.datasets[0].data.push(lon);

                // ç§»å‹•é€Ÿåº¦ã‚’è¨ˆç®—
                let speed = 0;
                if (prevLat !== null && prevLon !== null && prevTime !== null) {
                    const distance = getDistanceFromLatLon(prevLat, prevLon, lat, lon);
                    const timeElapsed = (timeNow - prevTime) / 1000; // ç§’
                    speed = distance / timeElapsed;
                }
                prevLat = lat;
                prevLon = lon;
                prevTime = timeNow;

                // ç§»å‹•é€Ÿåº¦ã‚°ãƒ©ãƒ•ã®æ›´æ–°
                speedChart.data.labels.push(now.toLocaleTimeString());
                speedChart.data.datasets[0].data.push(speed);

                // ã‚°ãƒ©ãƒ•æç”»å®Ÿè¡Œ
                //if (flg_chart_plotting) {
                [latitudeChart, longitudeChart, speedChart].forEach(chart => {
                    // æœ€æ–°ã®20ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã®ã¿ã‚’è¡¨ç¤º
                    //if (chart.data.labels.length > 200) {
                    //    chart.data.labels.shift();
                    //    chart.data.datasets[0].data.shift();
                    //}
                    chart.update();
                })
            };

            // è¨ˆæ¸¬ä¸­ã®å ´åˆã€ä½ç½®æƒ…å ±ã‚’IndexedDBã«ä¿å­˜
            // è¿½åŠ ã—ãŸã„æ©Ÿèƒ½ï¼šåœæ­¢ä¸­ã¯ä¿å­˜ã—ãªã„ãªã©ã—ãŸã„ã€‚ç§»å‹•é‡ãŒä¸€å®šä»¥ä¸Šã§ãªã„å ´åˆã¯ä½•ã‚‚ã—ãªã„ãªã©ã€‚
            if (isRecording) {
                await db.rowdata.add({
                    timestamp: now.getTime(),
                    latitude: lat,
                    longitude: lon
                });
            }
        }

        // ã‚°ãƒ©ãƒ•æç”»ã®é–‹å§‹/åœæ­¢ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šï¼šé–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰é™å®šã®æ©Ÿèƒ½
        document.getElementById('startplotButton').addEventListener('click', () => {
            flg_chart_plotting = true;
            document.getElementById('startplotButton').disabled = true;
            document.getElementById('stopplotButton').disabled = false;
        });
        document.getElementById('stopplotButton').addEventListener('click', () => {
            flg_chart_plotting = false;
            document.getElementById('startplotButton').disabled = false;
            document.getElementById('stopplotButton').disabled = true;
        });
        document.getElementById('resetplotButton').addEventListener('click', () => {
            // ãƒ©ãƒ™ãƒ«ã¨ãƒ‡ãƒ¼ã‚¿ã‚’ç©ºã«è¨­å®š
            [latitudeChart, longitudeChart, speedChart].forEach(chart => {
                chart.data.labels = [];  // ãƒ©ãƒ™ãƒ«ã‚’ç©ºã«ã™ã‚‹
                chart.data.datasets.forEach(dataset => {
                    dataset.data = [];   // å„ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’ç©ºã«ã™ã‚‹
                });
                // ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°ã—ã¦ãƒªã‚»ãƒƒãƒˆã‚’åæ˜ 
                chart.update();
            })
        });

        // ç·¯åº¦çµŒåº¦ã‹ã‚‰ã®è·é›¢è¨ˆç®—
        function getDistanceFromLatLon(lat1, lon1, lat2, lon2) {
            const R = 6371000; // åœ°çƒã®åŠå¾„ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // è·é›¢ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰
        }

        function deg2rad(deg) {
            return deg * (Math.PI / 180);
        }

        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°é–¢æ•°
        function handleError(error) {
            console.error("ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:", error.message);
        }

        const mapElement = document.getElementById('map');
        const graphElement = document.getElementById('developer-group');
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé–‹ã„ãŸã¨ãã€ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ¨ªã«ãšã‚‰ã™
        function updateMainContent() {
            console.log("updateMainContent");
            if (sidemenu.classList.contains('open')) {
                mapElement.classList.add('shifted');
                graphElement.classList.add('shifted');
            } else {
                mapElement.classList.remove('shifted');
                graphElement.classList.remove('shifted');
            }
        }

        // ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼é–¢é€£
        const sidemenu_toggle = document.getElementById('sidemenu-toggle');
        const sidemenu = document.getElementById('sidemenu');
        const pinCheckbox = document.getElementById('pin-checkbox');
        let isPinned = false;
        console.log("isPinned: "+isPinned)

        // ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®åˆ‡ã‚Šæ›¿ãˆ
        // ãƒˆã‚°ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§é–‹ã
        sidemenu_toggle.addEventListener('click', () => {
            sidemenu.classList.toggle('open');
            updateMainContent();
        });
        // ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãƒ›ãƒãƒ¼ã—ãŸã¨ãã«é–‹ã
        sidemenu_toggle.addEventListener('mouseenter', () => {
            sidemenu.classList.add('open');
            updateMainContent();
        });

        // ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ãƒã‚¦ã‚¹ãŒé›¢ã‚ŒãŸã¨ãã«é–‰ã˜ã‚‹
        sidemenu_toggle.addEventListener('mouseleave', () => {
            if (!isPinned) {
                sidemenu.classList.remove('open');
            }
            updateMainContent();
        });
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å¤–å´ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«è‡ªå‹•ã§é–‰ã˜ã‚‹
        document.addEventListener('click', (event) => {
            if (!isPinned && sidemenu.classList.contains('open')) {
                // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè¦ç´ ãŒãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã‚‚ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã§ã‚‚ãªã„å ´åˆ
                if (!sidemenu.contains(event.target) && !toggleButton.contains(event.target)) {
                    sidemenu.classList.remove('open');
                    updateMainContent();
                }
            }
        });

        // ãƒ”ãƒ³ç•™ã‚ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¤‰æ›´ã‚’ç›£è¦–
        pinCheckbox.addEventListener('change', () => {
            isPinned = pinCheckbox.checked;
        });
        
        // ãŠæ°—ã«å…¥ã‚Šãƒ¢ãƒ¼ãƒ‰ã®ãƒˆã‚°ãƒ«
        document.getElementById('favoriteModeToggle').addEventListener('change', (event) => {
            if (event.target.checked) {
                console.log("ãŠæ°—ã«å…¥ã‚Šãƒ¢ãƒ¼ãƒ‰ãŒã‚ªãƒ³ã«ãªã‚Šã¾ã—ãŸ");
                // ãŠæ°—ã«å…¥ã‚Šã‚¹ãƒãƒƒãƒˆã®è¡¨ç¤º
                // ã‚¹ãƒãƒƒãƒˆã‚’è¡¨ç¤º
                //const spotData = document.getElementById('spots').textContent;
                toggleSpots(spotData);
            } else {
                console.log("ãŠæ°—ã«å…¥ã‚Šãƒ¢ãƒ¼ãƒ‰ãŒã‚ªãƒ•ã«ãªã‚Šã¾ã—ãŸ");
                // ãŠæ°—ã«å…¥ã‚Šã‚¹ãƒãƒƒãƒˆã®éè¡¨ç¤º
                //const spotData = document.getElementById('spots').textContent;
                toggleSpots(spotData);
            }
        });
        // é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã®ãƒˆã‚°ãƒ«
        document.getElementById('devModeToggle').addEventListener('change', (event) => {
            if (event.target.checked) {
                console.log("é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ãŒã‚ªãƒ³ã«ãªã‚Šã¾ã—ãŸ");
                developer_mode = true;
                document.getElementById('startplotButton').disabled = false;
                document.getElementById('stopplotButton').disabled = true;
                developer_group_visibility(true);
            } else {
                console.log("é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ãŒã‚ªãƒ•ã«ãªã‚Šã¾ã—ãŸ");
                developer_mode = false;
                flg_chart_plotting = false;
                developer_group_visibility(false);
            }
        });

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åœ°å›³æ“ä½œã‚’æ¤œå‡º
        map.on('dragstart', () => {
            userInteracting = true;
        });
        map.on('dragend', () => {
            setTimeout(() => {
                userInteracting = true;
            }, 1000);
        });

        // ç¾åœ¨åœ°ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½
        document.getElementById('recenter-button').addEventListener('click', () => {
            if (userMarker) {
                map.setView(userMarker.getLatLng(), map.getZoom());
                userInteracting = false;
            }
        });

        // è¨ˆæ¸¬çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ãƒ•ãƒ©ã‚°
        let isRecording = false;

        // è¨ˆæ¸¬é–‹å§‹ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('start-recording').addEventListener('click', () => {
            isRecording = true;
            document.getElementById('start-recording').disabled = true;
            document.getElementById('stop-recording').disabled = false;
            document.getElementById('recording-indicator').style.display = 'inline-block';
        });

        // åœæ­¢ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('stop-recording').addEventListener('click', () => {
            isRecording = false;
            document.getElementById('start-recording').disabled = false;
            document.getElementById('stop-recording').disabled = true;
            document.getElementById('recording-indicator').style.display = 'none';
            document.getElementById('download-route').style.display = 'inline-block';
        });

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('download-route').addEventListener('click', async () => {
            // DBã‹ã‚‰çµŒè·¯ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const routeData = await db.rowdata.toArray();
            const format = prompt("ä¿å­˜å½¢å¼ã‚’é¸æŠã—ã¦ãã ã•ã„ (json ã¾ãŸã¯ gpx)", "gpx").toLowerCase();

            // GeoJSON ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç”Ÿæˆ
            if (format === 'json') {
                const geoJson = {
                    type: "FeatureCollection",
                    features: [{
                        type: "Feature",
                        properties: {},
                        geometry: {
                            type: "LineString",
                            coordinates: routeData.map(point => [point.longitude, point.latitude])
                        }
                    }]
                };
                const blob = new Blob([JSON.stringify(geoJson)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                downloadFile(url, 'recorded_route.json');
            } 
            // GPX ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç”Ÿæˆ
            else if (format === 'gpx') {
                const gpxData = `<?xml version="1.0" encoding="UTF-8"?>
        <gpx version="1.1" creator="MyApp" xmlns="http://www.topografix.com/GPX/1/1">
        <trk>
            <name>Recorded Route</name>
            <trkseg>
            ${routeData.map(point => `<trkpt lat="${point.latitude}" lon="${point.longitude}">
                <ele>${point.elevation || 0}</ele>
                <time>${new Date(point.timestamp).toISOString()}</time>
            </trkpt>`).join('')}
            </trkseg>
        </trk>
        </gpx>`;
                const blob = new Blob([gpxData], { type: 'application/gpx+xml' });
                const url = URL.createObjectURL(blob);
                downloadFile(url, 'recorded_route.gpx');
            } else {
                alert("ç„¡åŠ¹ãªå½¢å¼ã§ã™ã€‚'json' ã¾ãŸã¯ 'gpx' ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            }
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹é–¢æ•°
        function downloadFile(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('file-upload').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const fileExtension = file.name.split('.').pop().toLowerCase();
                    
                    if (fileExtension === 'json') {
                        // JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
                        const uploadedCourse = JSON.parse(e.target.result);
                        localStorage.setItem('uploadedCourse', JSON.stringify(uploadedCourse));
                        addCourseOption('uploaded_course', 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚³ãƒ¼ã‚¹');
                        displayCourse(uploadedCourse);
                    } else if (fileExtension === 'gpx') {
                        // GPXãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(e.target.result, 'application/xml');
                        const coordinates = [];
                        
                        // GPXå†…ã®<trkpt>ã‚¿ã‚°ã‚’ã™ã¹ã¦å–å¾—
                        const trkpts = xmlDoc.getElementsByTagName('trkpt');
                        for (let i = 0; i < trkpts.length; i++) {
                            const lat = parseFloat(trkpts[i].getAttribute('lat'));
                            const lon = parseFloat(trkpts[i].getAttribute('lon'));
                            coordinates.push([lon, lat]);  // GeoJSON å½¢å¼ã«åˆã‚ã›ã¦ [çµŒåº¦, ç·¯åº¦] ã®é †ã«å¤‰æ›
                        }

                        // GPXãƒ‡ãƒ¼ã‚¿ã‚’GeoJSONå½¢å¼ã«å¤‰æ›
                        const gpxCourse = {
                            type: "FeatureCollection",
                            features: [{
                                type: "Feature",
                                properties: {},
                                geometry: {
                                    type: "LineString",
                                    coordinates: coordinates
                                }
                            }]
                        };
                        localStorage.setItem('uploadedCourse', JSON.stringify(gpxCourse));
                        addCourseOption('uploaded_course', 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚³ãƒ¼ã‚¹');
                        displayCourse(gpxCourse);
                    } else {
                        alert('å¯¾å¿œã—ã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™ã€‚JSONã¾ãŸã¯GPXãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
                    }
                };
                reader.readAsText(file);
            }
        });
        // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«ã‚³ãƒ¼ã‚¹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
        function addCourseOption(value, text) {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = text;
            document.getElementById('course-dropdown').appendChild(option);
            document.getElementById('course-dropdown').value = value;
        }

        // ä½ç½®æƒ…å ±ã®ç›£è¦–ã‚’é–‹å§‹
        function getposition() {
            //console.log("ä½ç½®æƒ…å ±ã®ç›£è¦–")
            if ("geolocation" in navigator) {
                //getCurrentPosition, watchPosition
                navigator.geolocation.getCurrentPosition(updatePosition, handleError, {
                    enableHighAccuracy: true,
                    timeout: 2000,
                    maximumAge: 0
                });
            } else {
                alert("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚");
            }
        }

        // 1ç§’ã”ã¨ã«åœ°å›³ã‚’æ›´æ–°
        setInterval(() => {
            getposition()
            if (userMarker) {
                // ãƒ¦ãƒ¼ã‚¶ãŒåœ°å›³æ“ä½œä¸­ã®å ´åˆã¯ãƒ”ãƒ³ã‚’ä¸­å¿ƒã«ã™ã‚‹å‡¦ç†ã‚’ã—ãªã„
                if (!userInteracting) {
                    map.setView(userMarker.getLatLng());
                }
            }
        }, 200);
    </script>

    <!-- çµŒè·¯ãƒ‡ãƒ¼ã‚¿_ã‚µãƒ³ãƒ—ãƒ« -->
    <script id="non_cource" type="application/json">
        {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "LineString",
                        "coordinates": [
                        ]
                    },
                    "properties": {
                        "name": "non_cource"
                    }
                }
            ]
        }
    </script>
    <script id="nagoya_to_okazaki" type="application/json">
        {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "LineString",
                        "coordinates": [
                            [136.9066, 35.1802],
                            [137.0489, 34.9637]
                        ]
                    },
                    "properties": {
                        "name": "åå¤å±‹ã‹ã‚‰å²¡å´"
                    }
                }
            ]
        }
    </script>
    <script id="nagoya_tour" type="application/json">
        {
            "type":"FeatureCollection",
            "features":[
                {
                    "type":"Feature",
                    "properties":{},
                    "geometry":{
                        "type":"LineString",
                        "coordinates":[
                            [136.884572, 35.171330],
                            [136.889877, 35.172177],
                            [136.897045, 35.172977],
                            [136.903609, 35.173441],
                            [136.906234, 35.173662],
                            [136.905793, 35.178060],
                            [136.905229, 35.181907],
                            [136.904786, 35.184613],
                            [136.902525, 35.184607],
                            [136.899720, 35.184329]
                        ]
                    }
                }
            ]
        }
    </script>

    <!-- ã‚¹ãƒãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ -->
    <script id="spots" type="application/json">
        {
            "spots": [
                {
                    "name": "åå¤å±‹åŸ",
                    "coordinates": [136.8999, 35.1852],
                    "description": "åå¤å±‹ã®è±¡å¾´çš„ãªåŸã§ã™ã€‚",
                    "image": "path/to/nagoyajo.jpg"
                },
                {
                    "name": "å²¡å´åŸ",
                    "coordinates": [137.0622, 34.9667],
                    "description": "å²¡å´ã®æ­´å²çš„ãªåŸã§ã™ã€‚",
                    "image": "path/to/okazakijo.jpg"
                },
                {
                    "name": "å¤§é ˆè¦³éŸ³",
                    "coordinates": [136.9053, 35.1671],
                    "description": "åå¤å±‹ã®æœ‰åãªå¯ºé™¢ã§ã™ã€‚",
                    "image": "path/to/osu_kannon.jpg"
                }
            ]
        }
    </script>
    <script>
        // çµŒè·¯æƒ…å ±ã®ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const jsonData_non_cource = document.getElementById('non_cource').textContent;
        const jsonData_nagoya_tour = document.getElementById('nagoya_tour').textContent;
        const jsonData_nagoya_to_okazaki = document.getElementById('nagoya_to_okazaki').textContent;
        // ã‚¹ãƒãƒƒãƒˆæƒ…å ±ã®ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const spotData = document.getElementById('spots').textContent;
    </script>
    
</body>
</html>